(()=>{"use strict";var t={m:{},u:t=>t+".js"};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),t.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),(()=>{var n;t.g.importScripts&&(n=t.g.location+"");var o=t.g.document;if(!n&&o&&(o.currentScript&&(n=o.currentScript.src),!n)){var e=o.getElementsByTagName("script");e.length&&(n=e[e.length-1].src)}if(!n)throw new Error("Automatic publicPath is not supported in this browser");n=n.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=n})(),t.b=document.baseURI||self.location.href;const n=150;function o(t,n){return t<0&&(t=149),t>149&&(t=0),n<0&&(n=79),n>79&&(n=0),{x:t,y:n}}const e=[[1,0],[0,-1],[-1,0],[0,1]],r=(t,n,o)=>o&&o[t]&&o[t][n]&&o[t][n].bot;function c(t){return t.push(t.shift()),t}const i=(t,n,o)=>(delete o[t][n].bot,o);function a(t,o,e,r){if(((t,o)=>{if(t>=n||t<0)throw new Error("x should be from 0 to 150");if(o>=80||o<0)throw new Error("x should be from 0 to 150")})(t,o),r[t][o].bot)throw new Error(`Bot already exists in cell ${t}:${o}`);return r[t][o].bot=e,r}function s(t,n,o){return o[t][n]}const u={x:0,y:0,direction:0,id:null,rotate:1,program:{commands:[],current:0},options:{},xp:127,style:{h:1,s:1,b:1}};function d(){return`${Math.random()}`}function f(t,n,o){return{...u,id:d(),x:t,y:n,direction:Math.floor(4*Math.random()),rotate:Math.random()>.5?1:-1,program:o(),options:{},style:{h:Math.random(),s:Math.random(),v:Math.random()}}}function m(t){t.xp-=1}function l(t,n,o){t.xp<=0&&(i(t.x,t.y,n.map),o(t,n.map))}const p={generateId:d,generateRandom:f,liveStep:m,tryDie:l,cloneBot:function(t,n={}){return{x:void 0===n.x?t.x:n.x,y:void 0===n.y?t.y:n.y,id:void 0===n.id?t.id:n.id,direction:void 0===n.direction?t.direction:n.direction,xp:void 0===n.xp?t.xp:n.xp,rotate:t.rotate,program:{commands:t.program.commands.slice(),current:t.program.current},options:{...t.options},style:{h:t.style.h,s:t.style.s,v:t.style.v},processing:t.processing}},isProcessing:function(t){return!1===t.processing},DEFAULT_BOT:u,RIGHT:0,TOP:1,LEFT:2,BOTTOM:3,DEFAULT_XP:10};function g(t,n,o,e){e[t][n].resources={...e[t][n].resources,...o}}const h={MOVE:0,CLONE:1,EAT:2,EAT_SOLAR:3,ROTATE_CLOCKWISE:4,ROTATE_COUNTERCLOCKWISE:5};function x(t){return t[Math.floor(Math.random()*t.length)]}function y(){return x(Object.values(h))}function E(t){const n=.01;let o=Math.random()>.5?1:-1;return(t+n*o<=0||t+n*o>=1)&&(o*=-1),t+n*o}const b={execute:function(t,n){const c=function(t){const n=e[t.direction];return o(t.x+n[0],t.y+n[1])}(t);t.options.hasBotInFront=!!r(c.x,c.y,n.map),t.options.hasBotInFront||function(t,n,o){if(r(n.x,n.y,o))throw new Error(`Bot in cell ${n.x}:${n.y} already exists`);((t,n,o,e)=>{e[t][n]={...e[t][n],...o}})(n.x,n.y,{bot:t},o),i(t.x,t.y,o),t.x=n.x,t.y=n.y}(t,c,n.map)}},w={execute:function(t,n){t.direction=t.direction+1&3}},T={execute:function(t,n){t.direction=t.direction+-1&3}},O={execute:function(t,n){const o=s(t.x,t.y,n.map);o.resources.food&&(t.xp+=100,t.xp>255&&(t.xp=255),delete o.resources.food)}},v={execute:function(t,n){const o=s(t.x,t.y,n.map);t.xp+=3*o.resources.light.power}},M={execute:function(t,n){const i=function(t){const n=c(c(e))[t.direction];return o(t.x+n[0],t.y+n[1])}(t);if(r(i.x,i.y,n.map))return;if(t.xp<2*p.DEFAULT_XP)return;t.xp/=2;const s=p.cloneBot(t,{...i,id:p.generateId(),direction:(u=t.direction,u+2&3),xp:p.DEFAULT_XP});var u;a(s.x,s.y,s,n.map)}},I=function(t,n){},A=function(t,n){if(!0===t.processing)return;t.processing=!0;const o={[h.MOVE]:b,[h.ROTATE_CLOCKWISE]:w,[h.ROTATE_COUNTERCLOCKWISE]:T,[h.EAT]:O,[h.EAT_SOLAR]:v,[h.CLONE]:M};t.program.current>=t.program.commands.length&&(t.program.current=t.program.commands.length-1);const e=t.program.commands[t.program.current];void 0!==e&&(t.program.current+=1,t.program.current>=t.program.commands.length&&(t.program.current=0),o[e].execute(t,n),e===h.EAT_SOLAR&&I(t,n))},C=function(){const t=[h.MOVE,h.ROTATE_CLOCKWISE,h.ROTATE_COUNTERCLOCKWISE,h.EAT,h.EAT_SOLAR,h.CLONE];return t[Math.floor(Math.random()*t.length)]};function L(){const t=[];for(let n=0;n<10;n+=1)t.push(C());return{commands:t,current:0}}function R(t,o){for(let t=0;t<n;t+=1)for(let n=0;n<80;n+=1)o(t,n)}function $(t,n,o){R(0,((e,c)=>{const i=r(e,c,t.map);i&&n(i,o)}))}function S(t){$(t,(n=>{(function(t){if(Math.random()>.001)return;const n=[(t,n)=>function(t,n){return t[n]=y(),t}(t,n),(t,n)=>function(t,n){return t.splice(n,1),t}(t,n),(t,n)=>function(t,n){return t.splice(n,0,y()),t}(t,n)],o=Math.floor(Math.random()*t.program.commands.length);x(n)(t.program.commands,o),t.style.h=E(t.style.h),t.style.s=E(t.style.s),t.style.v=E(t.style.v)})(n),function(t,n){A(t,n)}(n,t),m(n),l(n,t,((t,n)=>{g(t.x,t.y,{food:{type:"food"}},n)}))})),function(t){$(t,(t=>{t.processing=!1}))}(t)}const _=(t,n,o)=>t>=o[0]&&t<=o[2]&&n>=o[1]&&n<=o[3],B=10;function D(t,o,e,r){let c=o*n*B*4+4*t;r.data[c]=e.r,c+=1,r.data[c]=e.g,c+=1,r.data[c]=e.b,c+=1,r.data[c]=void 0===e.a?255:e.a}function F(t,n){!function(t,n){const o=function(t){const n=[0,.15,.3,.45,.6,.75,.9],o=t.program.commands.map((t=>n[t])),e=o.reduce(((t,n)=>t+n),0)/o.length||0;return function(t,n,o){let e,r,c;1===arguments.length&&(n=t.s,o=t.v,t=t.h);const i=Math.floor(6*t),a=6*t-i,s=o*(1-n),u=o*(1-a*n),d=o*(1-(1-a)*n);switch(i%6){case 0:e=o,r=d,c=s;break;case 1:e=u,r=o,c=s;break;case 2:e=s,r=o,c=d;break;case 3:e=s,r=u,c=o;break;case 4:e=d,r=s,c=o;break;case 5:e=o,r=s,c=u}return{r:Math.round(255*e),g:Math.round(255*r),b:Math.round(255*c)}}(t.style.h,t.style.s,e)}(t);!function(t,n,o,e,r,c){const i=t+1,a=t+B-2,s=n+1,u=n+B-2,d=t,f=t+B-1,m=n,l=n+B-1,g={[p.RIGHT]:[f-1,m+4,f,l-4],[p.TOP]:[d+4,m,f-4,m+1],[p.LEFT]:[d,m+4,d+1,l-4],[p.BOTTOM]:[d+4,l-1,f-4,l]}[e];!function(t,n,o,e,r,c,i){for(let a=t;a<=n;a+=1)_(o,a,e)||D(o,a,r,c),_(i,a,e)||D(i,a,r,c)}(s,u,d,g,r,c,f),function(t,n,o,e,r,c,i){for(let a=t;a<=n;a+=1)_(a,o,e)||D(a,o,r,c),_(a,i,e)||D(a,i,r,c)}(i,a,m,g,r,c,l),function(t,n,o,e,r,c,i){for(let a=t;a<=n;a+=1)for(let t=o;t<=e;t+=1)_(a,t,r)||D(a,t,c,i)}(i,a,s,u,g,r,c)}(t.x*B,t.y*B,0,t.direction,o,n)}(t,n.imageData)}function U(t){const n=t.ctx.createImageData(1500,800);!function(t){t.data.fill(0);for(let n=0;n<48e5;n+=4)t.data[n+3]=255}(n),function(t,n){R(0,((o,e)=>{const r=s(o,e,t.map);r.resources&&function(t,n,o,e){o.food&&function(t,n,o,e){for(let r=t+3;r<t+B-3;r+=1)for(let t=n+3;t<n+B-3;t+=1)D(r,t,o,e)}(t*=B,n*=B,{r:140,g:80,b:0},e)}(o,e,r.resources,n)}))}(t.world,n),$(t.world,F,{imageData:n}),t.ctx.putImageData(n,0,0)}const W={};let k,P=0;window.counter=0;const N=document.getElementById("cnv"),K=document.getElementById("info"),X=N.clientWidth/n,j=N.clientHeight/80,H=()=>{void 0!==W.botX&&void 0!==W.botY&&(W.bot=r(W.botX,W.botY,k.map))},V=t=>{W.botX=parseInt(t.x/X,10),W.botY=parseInt(t.y/j,10),H()};function Y(){const{bot:t}=W;void 0===t||t&&t.xp<=0?H():K.innerHTML=`x: ${t.x}</br>y: ${t.y}</br>xp: ${parseInt(t.xp,10)}</br>program: ${t.program.commands}</br>id: ${t.id}</br>`}function q(t){k=t,N.addEventListener("mousedown",V),setInterval(Y,1e3)}function G(t,n){const o=performance.now();return t(n),performance.now()-o}function z(t,n){S(t),U(n);var o;o=[G(S,t),G(U,n)],window.counter++,P+=1,window.debugInfo1=`${P} ${Date.now()} perf: ${o[0]}, ${o[1]} milliseconds`,Y(),requestAnimationFrame((()=>z(t,n)))}String.prototype.hashCode=function(){let t,n,o=0;if(0===this.length)return o;for(t=0;t<this.length;t+=1)n=this.charCodeAt(t),o=(o<<5)-o+n,o|=0;return o};const J=function(){const t=function(){const t={map:[]};return function(t){R(0,((n,o)=>{!function(t,n,o,e={resources:{}}){void 0===o[t]&&(o[t]=[]),o[t][n]=e}(n,o,t.map)}))}(t),function(t){R(0,((n,o)=>{Math.random()>.9&&a(n,o,f(n,o,L),t.map)}))}(t),function(t){R(0,((n,o)=>{Math.random()>.9&&g(n,o,{food:{type:"food"}},t.map),g(n,o,{light:{type:"light",power:1-o/80}},t.map)}))}(t),window.debugWorld=t,t}(),n=function(t){const n=document.getElementById("cnv");n.width=1500,n.height=800;const o={world:t,ctx:n.getContext("2d")};return o.ctx=n.getContext("2d"),o.ctx.imageSmoothingEnabled=!1,o}(t);!function(t,n){requestAnimationFrame((()=>z(t,n))),setInterval((()=>{console.log(Date.now(),window.debugInfo1)}),1e3),q(t)}(t,n)};J();const Q=new Worker(new URL(t.p+t.u(736),t.b));Q.onmessage=function(t){console.log("Message from worker:",t.data)},setInterval((()=>{Q.ready.then((t=>{t.active.postMessage("Hi service worker"),console.log("messages posted",t)}))}),2e3)})();
//# sourceMappingURL=main.js.map